<div class="mobile-nav" style="width: 100%;">
    <ul class="nav navbar-nav navbar-right" style="width: 100%;">
        <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" data-testid="loggedin_user_icon" style="background-color: white;">
                <div  class="navbar-toggle">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </div>
            </a>
            <ul class="dropdown-menu" style="width: 100%; margin-left:-2px;padding-right:55px">
                <li class="extra-padding-tb"> 
                    <a href="{{ url_for('home.index') }}" class="nav-link" title="{{ _('SAEOSS Homepage') }}">{{ _('Home') }}</a>
                </li>
                <li class="extra-padding-tb"> 
                    <a href="{{ url_for('dataset.search') }}" class="nav-link" title="{{ _('Metadata/Dataset search page') }}" >{{ _('Metadata') }}</a>
                </li>
                <li class="extra-padding-tb">
                    <a href="{{ url_for('map.index') }}" class="nav-link" title="{{ _('Metadata boundary view') }}" >{{ _('Map') }}</a>
                </li>
                <li class="extra-padding-tb hide-on-small"> 
                    <a href="{{ url_for('organization.index') }}" class="nav-link" title="{{ _('SAEOSS organization (metadata collection)') }}" >{{ _('Organisations') }}</a>
                </li>
                <li class="extra-padding-tb hide-on-small"> 
                    <a href="https://kartoza.github.io/SAEOSS-Portal/user/quickstart/" title="{{ _('SAEOSS help and documentation') }}"  class="nav-link" title="Help">Help</a>
                </li>
                {% if c.userobj %}
                    {% if h.check_access('package_create') %}
                    <li class="extra-padding-tb"> 
                        <a href="{{ url_for('dataset.new') }}" style="padding-left: 20px;" title="{{ _('Metadata/Dataset search page') }}" >{{ _('Add Metadata') }}</a>
                    </li>
                    {% endif %}

                    <li>
                        <a href="#" class="user-menu-toggle extra-padding-tb" role="button" aria-haspopup="true" aria-expanded="false" data-testid="loggedin_user_icon" style="margin-top: 5px; padding-left: 20px;margin-bottom:10px"> {{ h.user_image((c.user if c and c.user else ''), size=22) }}
                        <span class="username">{{ c.userobj.display_name }}</span>
                        </a>
                        <ul class="user-menu" style="display: none;">
                            <li class="extra-padding-tb"> 
                                <a href="{{ h.url_for('user.read', id=c.userobj.name) }}" title="{{ _('View profile') }}">
                                <span class="text">{{ _('Profile') }}</span></a>
                            </li>
                            {% set new_activities = h.new_activities() %}
                            {% if h.saeoss_org_memberships(c.userobj.id) %}
                                <li class="extra-padding-tb">
                                    <a href="{{ h.url_for('harvest.search') }}" title="{{ _('Harvesting Settings') }}">
                                    <span class="text">{{ _('Harvesting Settings') }}</span>
                                    </a>
                                </li>
                                
                            {% endif %}
                            <li class="notifications {% if new_activities > 0 %}notifications-important{% endif %} extra-padding-tb">
                                {% set notifications_tooltip = ngettext('Dashboard (%(num)d new item)', 'Dashboard (%(num)d new items)',
                                new_activities)
                                %}
                                <a href="{{ h.url_for('dashboard.index') }}" title="{{ notifications_tooltip }}">
                                <span class="text">{{ _('Dashboard') }}</span>
                                <span class="badge">{{ new_activities }}</span>
                                </a>
                            </li>
                            {% block header_account_settings_link %}
                            <li class="extra-padding-tb">
                                <a href="{{ h.url_for('user.edit', id=c.userobj.name) }}" title="{{ _('Profile settings') }}">
                                <span class="text">{{ _('Profile settings') }}</span>
                                </a>
                            </li>
                            {% endblock %}
                            {% block header_usage_stats_link %}
                                <li class="extra-padding-tb">
                                    <a href="{{ h.url_for('stats.index') }}" title="{{ _('Usage statistics') }}">
                                        <span class="text">{{ _('Usage statistics') }}</span>
                                    </a>
                                </li>
                            {% endblock %}
                                {% if c.userobj.sysadmin %}
                                <li class="extra-padding-tb">
                                    <a href="/user" title="{{ _('Users') }}">
                                    <span class="text">{{ _('Users') }}</span>
                                    </a>
                                </li>
                                <li class="extra-padding-tb">
                                    <a href="{{ h.url_for('admin.index') }}" title="{{ _('Sysadmin settings') }}">
                                    <span class="text">{{ _('Sysadmin settings') }}</span>
                                    </a>
                                </li>
                                <li class="extra-padding-tb">
                                    <a href="{{ h.url_for('validator.index') }}" title="{{ _('Metadata Validator') }}">
                                    <span class="text">{{ _('Metadata Validator') }}</span>
                                    </a>
                                </li>
                                <li class="extra-padding-tb">
                                    <a href="{{ h.url_for('stac_harvest.view') }}" title="{{ _('STAC Harvester') }}">
                                    <span class="text">{{ _('STAC Harvester') }}</span>
                                    </a>
                                </li>
                            {% endif %}
                            {#
                            This next section has been borrowed and adapted from ckanext-pages header.html template. One
                            notable difference is that we only show the pages-related nav items if the current user is allowed
                            to modify them. This means that we need to provide means for these contents to be visible elsewhere
                            like for example providing link to them via the main nav.
                            #}
                            <li class="extra-padding-tb">
                                <a href="{{ h.url_for('saved_searches.index') }}" title="{{ _('Saved Search') }}" data-testid="logout">
                                        <!-- <i class="fa fa-bookmark-o" aria-hidden="true"></i> -->
                                        <span class="text">{{ _('Saved Search') }}</span>
                                    </a>
                            </li>
                            {% block header_account_log_out_link %}
                                <li class="extra-padding-tb">
                                    <a href="{{ h.url_for('user.logout') }}" title="{{ _('Log out') }}" data-testid="logout">
                                        <!-- <i class="fa fa-sign-out" aria-hidden="true"></i> -->
                                        <span class="text">{{ _('Log out') }}</span>
                                    </a>
                                </li>
                            {% endblock %}

                        </ul>
                    </li>

                {% else %}
                {% block header_account_notlogged %}
                    <li class="extra-padding-tb" data-testid="nav_login">
                        <a href="/user/login" style="padding-left: 20px;">LOG IN</a>
                    </li>
                    {% if h.check_access('user_create') %}
                    <li class="extra-padding-tb" class="no-hover">
                        <a style="padding-left: 20px;" class="blue-btn" href="/sign-up/">SIGN UP</a>
                    </li>
                    {% endif %}
                {% endblock %}
                {% endif %}
            </ul>
        </li>
    </ul>
<script>
// Custom toggle for user menu in mobile nav
document.addEventListener('DOMContentLoaded', function() {
    var userToggle = document.querySelector('.user-menu-toggle');
    var userMenu = document.querySelector('.user-menu');
    if (userToggle && userMenu) {
        userToggle.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation(); // Prevent closing parent dropdown
            userMenu.style.display = userMenu.style.display === 'block' ? 'none' : 'block';
            // Optionally toggle aria-expanded
            var expanded = userToggle.getAttribute('aria-expanded') === 'true';
            userToggle.setAttribute('aria-expanded', !expanded);
        });
        // Optional: close user menu when clicking outside
        document.addEventListener('click', function(e) {
            if (!userMenu.contains(e.target) && !userToggle.contains(e.target)) {
                userMenu.style.display = 'none';
                userToggle.setAttribute('aria-expanded', false);
            }
        });
    }
});
</script>
</div>