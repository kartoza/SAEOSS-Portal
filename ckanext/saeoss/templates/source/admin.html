{% ckan_extends %}

{% block primary_content %}

  {% block content_blue_border %}
    <div class="page-header-blue-border-shadow" style="margin-top: 20px;">
      {% block content_primary_nav %}
      <div class="page-header-nav-tabs-parent">
        <div class="left-side-inner">
          <div class="page-header-nav-tabs">
            {{ h.build_nav_icon('harvester.admin', _('Dashboard'), id=harvest_source.name, icon='dashboard') }}
            {{ h.build_nav_icon('harvester.job_list', _('Jobs'), source=harvest_source.name, icon='reorder') }}
            {{ h.build_nav_icon(c.dataset_type ~ '.edit', _('Edit'), id=harvest_source.name, icon='edit') }}
          </div>
          <hr class="page-header-nav-tabs-hr">
        </div>
        <div class="right-side-inner">
          <div class="main-edit-button-parent">
            {% block content_action %}
            <div class="content_action btn-group">
            {% if harvest_source.status and harvest_source.status.last_job and (harvest_source.status.last_job.status == 'New' or harvest_source.status.last_job.status == 'Running') %}
              <a class="btn btn-default disabled" rel="tooltip" title="There already is an unrun job for this source"><i class="fa fa-lg fa-refresh icon-refresh icon-large"></i> Reharvest</a>
            {% else %}
              {% set locale = h.dump_json({'content': _('This will re-run the harvesting for this source. Any updates at the source will overwrite the local datasets. Sources with a large number of datasets may take a significant amount of time to finish harvesting. Please confirm you would like us to start reharvesting.')}) %}
                <a href="{{ h.url_for('harvester.refresh', id=harvest_source.id) }}" class="btn btn-default" data-module="confirm-action" data-module-i18n="{{ locale }}"
                  title="{{ _('Start a new harvesting job for this harvest source now') }}">
                  <i class="fa fa-refresh icon-refresh"></i>
                  {{ _('Reharvest') }}
                </a>
            {% endif %}
            {% if harvest_source.status and harvest_source.status.last_job and (harvest_source.status.last_job.status == 'Running') %}
                <a href="{{ h.url_for('harvester.job_abort', source=harvest_source.name, id=harvest_source.status.last_job.id) }}" class="btn btn-default" title="Stop this Job">
                  <i class="fa fa-ban icon-ban-circle"></i>
                  {{ _('Stop') }}
                </a>
            {% endif %}
              {% set locale = h.dump_json({'content': _('Warning: This will remove all datasets for this source, as well as all previous job reports. Are you sure you want to continue?')}) %}
                <a href="{{ h.url_for('harvester.clear', id=harvest_source.id) }}" class="btn btn-default" data-module="confirm-action" data-module-i18n="{{ locale }}"
                  title="{{ _('Delete all harvest jobs and existing datasets from this source') }}">
                  {{ _('Clear') }}
                </a>
                <a href="{{ h.url_for('{0}.read'.format(c.dataset_type), id=harvest_source.id) }}" class="btn btn-default">
                  <i class="fa fa-eye eye-open"></i>
                  {{ _('View harvest source') }}
                </a>
              </div>
          {% endblock %}
          </div>
        </div>
      </div>
      {% endblock %}
      
    </div>
    {% block primary_content_inner_header %}
      <section class="page-header-blue-border-shadow" style="margin-top: 20px;">
        <h1>{{ _('Last Harvest Job') }}</h1>
        {% if harvest_source.status and harvest_source.status.last_job %}
          {% snippet "snippets/job_details.html", job=harvest_source.status.last_job %}
          <div class="form-actions">
              <a href="{{ h.url_for('harvester.job_show_last', source=harvest_source.name) }}" class="btn pull-right btn-default">
              <i class="fa fa-briefcase icon-briefcase"></i>
              {{ _('View full job report')  }}
            </a>
          </div>
        {% else %}
          <p class="empty">{{ _('No jobs yet for this source') }}</p>
        {% endif %}
      </section>
    {% endblock %}

  {% endblock %}

{% endblock %}




